//TODO: Separate the styles into different files for better organization
//TODO: To deal with z-index in modals!

:host {
  display: block;
  height: 100%;
  min-height: 0;
  color: var(--rpg-text, #f2e4c2);
  font-family: "MedievalSharp", cursive, serif;
}

app-reward-modal {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9999;
  background-color: rgba(0, 0, 0, 0.8); // just for testing
  width: 100vw;
  height: 100vh;
}

app-defeat-modal {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9999;
  background-color: rgba(0, 0, 0, 0.8); // just for testing
  width: 100vw;
  height: 100vh;
}

.battle-container {
  display: grid;
  position: relative;
  height: 100%;
  width: 100%;
  grid-template-columns: 1fr 1fr 1fr 1fr 1fr 0.2fr 1fr;
  grid-template-rows: 1fr 1fr 1fr 1fr 1fr 1fr;
  background:
    linear-gradient(160deg, rgba(14, 11, 8, 0.62), rgba(14, 11, 8, 0.62)),
    url("/test/24.png") center center / cover no-repeat;
  grid-template-areas:
    "player-health    .             .           .           .       .                monster-stats"
    "player-health    monster       monster     monster    monster  .                monster-stats"
    "player-health    monster       monster     monster    monster  .                monster-stats"
    "player-health    monster       monster     monster    monster   battle-logs     battle-logs"
    ".                monster       monster     monster    monster   battle-logs     battle-logs"
    ".                abilities     abilities  abilities   abilities battle-logs     battle-logs";

  gap: 1rem;
}

.battle-container::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background:
    radial-gradient(circle at 52% 16%, rgba(212, 175, 55, 0.14), transparent 38%),
    radial-gradient(circle at 18% 72%, rgba(83, 111, 74, 0.14), transparent 40%);
}

.battle-container::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background:
    radial-gradient(circle at 50% 20%, rgba(255, 229, 153, 0.1), transparent 35%),
    radial-gradient(circle at 50% 88%, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.52) 90%);
  mix-blend-mode: screen;
  animation: battle-flicker 5.5s ease-in-out infinite;
}

.scene {
  grid-area: monster;
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;

  .monster-health-bar-container {
    position: relative;
    width: 15rem;
    display: flex;
    flex-direction: column;
    justify-content: end;
    align-items: center;

    .monster-health-bar {
      z-index: 2;
      max-width: 40%;
      animation: float 3.5s ease-in-out infinite;
      filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.7));
    }

    .health-wrapper {
      position: absolute;
      bottom: 35%;
      left: 35%;
      height: 30%;
      width: 30%;

      .health-fill {
        height: 100%;
        border-radius: 30%;
        background-color: red;
        z-index: 1;
        animation: float 3.5s ease-in-out infinite;
      }
    }
  }
  .monster {
    animation: float 3.5s ease-in-out infinite;
    max-width: 100%;
    max-height: 80%;
    filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.7));
  }
}

.panel-frame {
  background:
    radial-gradient(circle at 80% 8%, rgba(255, 210, 120, 0.08), transparent 40%),
    radial-gradient(circle at 12% 92%, rgba(132, 82, 36, 0.08), transparent 42%),
    linear-gradient(180deg, rgba(40, 27, 19, 0.94), rgba(25, 16, 12, 0.96));
  border: 2px solid rgba(180, 129, 52, 0.58);
  border-radius: 16px;
  box-shadow: inset 0 0 32px rgba(0, 0, 0, 0.55), 0 12px 24px rgba(0, 0, 0, 0.35);
}

.sheet-divider {
  width: 86%;
  margin: 0.4rem auto 0.7rem;
  opacity: 0.75;

  &.compact {
    width: 74%;
    margin: 0.35rem auto 0.5rem;
  }
}

.battle-logs {
  grid-area: battle-logs;
  z-index: 2;
  display: flex;
  flex-direction: column;
  padding: 0.8rem 0.9rem 1rem;
  min-height: 0;
  max-height: 340px;
  align-self: start;
  margin-top: 0.8rem;

  .panel-heading {
    text-align: center;
    color: #e7c87a;
    font-size: 1.18rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    text-shadow: 0 0 7px rgba(140, 90, 35, 0.4);
  }

  .battle-logs-wrapper {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 0.45rem 0.55rem;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(180, 129, 52, 0.65) rgba(14, 11, 8, 0.4);

    &::-webkit-scrollbar {
      width: 7px;
    }

    &::-webkit-scrollbar-track {
      background: rgba(14, 11, 8, 0.45);
      border-radius: 10px;
    }

    &::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #d2a94d, #896124);
      border-radius: 10px;
    }

    .log-entry {
      position: relative;
      margin-bottom: 0.35rem;
      padding: 0.25rem 0.15rem 0.25rem 1rem;
      color: #edd9b0;
      font-family: "Spectral SC", serif;
      font-size: 0.9rem;
      line-height: 1.45;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.6);
      animation: typeGlow 0.55s ease-out;

      &::before {
        content: "";
        position: absolute;
        left: 0.2rem;
        top: 0.76rem;
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background: #c89d44;
        box-shadow: 0 0 5px rgba(212, 175, 55, 0.45);
      }

      &.critical {
        color: #ff9d9d;
      }

      &.heal {
        color: #d3e2b0;
      }

      &.miss {
        color: #b7b0a2;
        font-style: italic;
      }

      &.log-empty {
        color: #bba786;
        text-align: center;
        padding-left: 0.2rem;

        &::before {
          display: none;
        }
      }
    }
  }
}

@keyframes typeGlow {
  0% {
    opacity: 0;
    transform: translateY(4px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.player-health-widget {
  grid-area: player-health;
  display: flex;
  justify-content: flex-start;
  align-items: flex-start;
  padding: 1rem 0 0 1rem;
  z-index: 2;
}

.player-health-bar {
  position: relative;
  width: min(18vw, 230px);
  aspect-ratio: 1 / 1;
  border-radius: 50%;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;

  .liquid-wrapper {
    position: absolute;
    width: 61%;
    height: 52%;
    border-radius: 50%;
    overflow: hidden;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    isolation: isolate;

    span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      font-family: "Cinzel", serif;
      font-size: 1.2rem;
      font-weight: bold;
      color: #f9f4e8;
      text-shadow: 0 0 2px rgba(0, 0, 0, 0.9), 0 0 4px rgba(212, 175, 55, 0.3),
        0 0 6px rgba(212, 175, 55, 0.15);
      letter-spacing: 1px;
      pointer-events: none;
      white-space: nowrap;
    }

    .liquid {
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      overflow: visible;
      border-radius: 5% 5% 0 0;
      background: #7a0000;
      will-change: transform;

      &::before,
      &::after {
        content: "";
        position: absolute;
        left: -120%;
        width: 340%;
        pointer-events: none;
        background-repeat: repeat-x;
        background-position: 0 0;
      }

      &::before {
        top: -12px;
        height: 24px;
        background-image: url("/hp-wave-tile.svg");
        background-size: 200px 24px;
        animation: liquidSurfaceDriftPrimary 7.2s linear infinite;
      }

      &::after {
        top: -10px;
        height: 20px;
        background-image: url("/hp-wave-tile.svg");
        background-size: 160px 20px;
        opacity: 0.68;
        animation: liquidSurfaceDriftSecondary 10.8s linear infinite;
        pointer-events: none;
      }

      &.danger {
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.4),
          0 0 25px rgba(255, 0, 0, 0.2);
      }
    }
  }

  .orb-frame {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    filter: drop-shadow(0 0 4px rgba(40, 20, 20, 0.4))
      drop-shadow(0 0 10px rgba(100, 20, 20, 0.15));
  }
}

.monster-stats {
  grid-area: monster-stats;
  z-index: 2;
  display: flex;
  flex-direction: column;
  padding: 0.75rem 0.8rem 0.9rem;
  color: #e9d2a8;
  min-height: 0;
  margin-top: 0.85rem;

  .sheet-header {
    display: flex;
    align-items: center;
    justify-content: center;
    width: fit-content;
    margin: 0 auto;
  }

  .sheet-title-wrap {
    min-width: 0;
    text-align: center;
  }

  h2 {
    margin: 0;
    font-family: "IM Fell English SC", serif;
    font-size: 1.45rem;
    color: #efc67a;
    line-height: 1.1;
    text-shadow: 0 0 7px rgba(174, 104, 33, 0.32);
    white-space: nowrap;
  }

  .sheet-health {
    display: grid;
    grid-template-columns: 42px minmax(0, 1fr) 62px;
    align-items: center;
    gap: 0.45rem;
    margin-bottom: 0.5rem;
  }

  .sheet-health-label {
    font-size: 0.72rem;
    color: #d2b681;
    text-transform: uppercase;
    letter-spacing: 0.4px;
  }

  .sheet-health-bar {
    position: relative;
    height: 16px;
    background: url("/bar-frame.svg") center / 100% 100% no-repeat;
    padding: 2px 6px;
  }

  .sheet-health-fill {
    height: 100%;
    border-radius: 4px;
    background:
      linear-gradient(180deg, #a51d1d 0%, #7d0808 55%, #4a0202 100%),
      repeating-linear-gradient(
        -45deg,
        rgba(255, 255, 255, 0.04) 0,
        rgba(255, 255, 255, 0.04) 4px,
        rgba(0, 0, 0, 0.08) 4px,
        rgba(0, 0, 0, 0.08) 8px
      );
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.45);
    transition: width 0.35s ease;
  }

  .sheet-health-value {
    text-align: right;
    font-size: 0.78rem;
    color: #eac98e;
    letter-spacing: 0.35px;
  }

  .sheet-section {
    margin-bottom: 0.38rem;

    h3 {
      margin: 0 0 0.28rem;
      color: #dfbe82;
      font-size: 0.86rem;
      letter-spacing: 0.7px;
      text-transform: uppercase;
    }
  }

  .sheet-stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.35rem 0.5rem;
  }

  .sheet-stat {
    display: grid;
    grid-template-columns: 16px minmax(0, 1fr) auto;
    align-items: center;
    gap: 0.35rem;
    min-width: 0;
    padding: 0.18rem 0.22rem;
    border: 1px solid rgba(155, 112, 42, 0.32);
    border-radius: 7px;
    background: rgba(19, 12, 9, 0.45);

    img {
      width: 14px;
      height: 14px;
      opacity: 0.95;
    }
  }

  .stat-label {
    min-width: 0;
    font-size: 0.75rem;
    color: #cfb789;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .stat-value {
    font-size: 0.76rem;
    color: #f1d6a3;
    white-space: nowrap;
  }

  .sheet-chips {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: 0.24rem;
  }

  .chip-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.4rem;
  }

  .chip-label {
    font-size: 0.72rem;
    color: #ceb88c;
    text-transform: uppercase;
    letter-spacing: 0.45px;
  }

  .sheet-chip {
    padding: 0.1rem 0.4rem;
    border-radius: 999px;
    border: 1px solid rgba(176, 128, 49, 0.62);
    background: rgba(24, 16, 11, 0.55);
    color: #dcc9a0;
    font-size: 0.68rem;
  }
}

@media (max-width: 1160px) {
  .monster-stats {
    .sheet-stats-grid {
      grid-template-columns: 1fr;
    }

    .sheet-header {
      width: 100%;
    }
  }
}

@media (max-width: 860px) {
  .battle-container {
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: auto auto 1fr auto;
    grid-template-areas:
      "player-health . monster-stats"
      "monster monster monster"
      "monster monster monster"
      "abilities abilities battle-logs";
  }

  .monster-stats,
  .battle-logs {
    min-height: 240px;
  }

  .battle-logs {
    max-height: 280px;
  }
}

@media (max-width: 640px) {
  .battle-container {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto auto auto auto;
    grid-template-areas:
      "player-health"
      "monster-stats"
      "monster"
      "abilities"
      "battle-logs";
    gap: 0.65rem;
    padding: 0.5rem;
  }

  .player-health-widget {
    padding: 0.25rem 0 0 0.35rem;
  }

  .monster-stats h2 {
    font-size: 1.25rem;
  }
}

.ability-canvas {
  grid-area: abilities;

  height: 100%;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;

  .ability-icon {
    background-image: url("/test/custom.png");
    border-radius: 35%;
    filter: drop-shadow(2px 10px 15px rgba(3, 10, 0, 0.7));
    width: 10%;
    cursor: pointer;
    position: relative; // ðŸ‘ˆ this is the key

    &:hover {
      transform: scale(1.05);
      filter: brightness(1.2) drop-shadow(0 0 8px rgba(212, 175, 55, 0.3));
    }
    &.disabled {
      pointer-events: none;
      filter: brightness(0.5) saturate(0.2);
      transform: none;
      opacity: 0.7;
    }
  }
}

@media (max-width: 768px) {
}

@keyframes liquidSurfaceDriftPrimary {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 200px 0;
  }
}

@keyframes liquidSurfaceDriftSecondary {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 160px 0;
  }
}

@keyframes float {
  0%,
  100% {
    transform: translate(0, 0);
  }
  50% {
    transform: translate(0, -8px);
  }
}

@keyframes battle-flicker {
  0%,
  100% {
    opacity: 0.52;
  }
  50% {
    opacity: 0.8;
  }
}
