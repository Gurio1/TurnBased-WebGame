<div class="battle-container" *ngIf="battleData">
  <div class="scene">
    <div class="monster-health-bar-container">
      <div class="health-wrapper">
        <div
          class="health-fill"
          [style.width.%]="monsterHealthPercentage"
        ></div>
      </div>
      <img
        src="/test/monster-health-bar.png"
        alt="Monster health bar"
        class="monster-health-bar"
      />
    </div>
    <img src="/test/goblin.png" alt="Goblin" class="monster" />

    <!-- <audio autoplay loop>
    <source src="assets/forest-ambience.mp3" type="audio/mpeg" />
  </audio> -->
  </div>
  <div class="monster-stats panel-frame">
    <div class="sheet-header">
      <div class="sheet-title-wrap">
        <h2>{{ battleData.monster.name }}</h2>
      </div>
    </div>

    <img
      class="sheet-divider"
      src="/battle-divider-ornate.svg"
      alt=""
      aria-hidden="true"
    />

    <div class="sheet-health">
      <span class="sheet-health-label">Health</span>
      <div class="sheet-health-bar">
        <div class="sheet-health-fill" [style.width.%]="monsterHealthPercentage"></div>
      </div>
      <span class="sheet-health-value">
        {{ battleData.monster.stats.currentHealth }} /
        {{ battleData.monster.stats.maxHealth }}
      </span>
    </div>

    <div class="sheet-section">
      <h3>Core</h3>
      <div class="sheet-stats-grid">
        <div class="sheet-stat">
          <img src="/battle-icon-shield.svg" alt="" aria-hidden="true" />
          <span class="stat-label">Armor</span>
          <span class="stat-value">{{ battleData.monster.stats.armor }}</span>
        </div>
        <div class="sheet-stat">
          <img src="/battle-icon-sword.svg" alt="" aria-hidden="true" />
          <span class="stat-label">Damage</span>
          <span class="stat-value">{{ battleData.monster.stats.damage }}</span>
        </div>
      </div>
    </div>

    <img
      class="sheet-divider compact"
      src="/battle-divider-ornate.svg"
      alt=""
      aria-hidden="true"
    />

    <div class="sheet-section">
      <h3>Advanced</h3>
      <div class="sheet-stats-grid">
        <div class="sheet-stat">
          <img src="/battle-icon-crit.svg" alt="" aria-hidden="true" />
          <span class="stat-label">Crit Chance</span>
          <span class="stat-value">{{
            asPercent(battleData.monster.stats.criticalChance)
          }}</span>
        </div>
        <div class="sheet-stat">
          <img src="/battle-icon-critdmg.svg" alt="" aria-hidden="true" />
          <span class="stat-label">Crit Dmg</span>
          <span class="stat-value">{{
            asPercent(battleData.monster.stats.criticalDamage)
          }}</span>
        </div>
        <div class="sheet-stat">
          <img src="/battle-icon-dodge.svg" alt="" aria-hidden="true" />
          <span class="stat-label">Dodge</span>
          <span class="stat-value">{{
            asPercent(battleData.monster.stats.dodgeChance)
          }}</span>
        </div>
      </div>
    </div>

    <div class="sheet-chips">
      <div class="chip-row">
        <span class="chip-label">Resists</span>
        <span class="sheet-chip">None</span>
      </div>
      <div class="chip-row">
        <span class="chip-label">Weak</span>
        <span class="sheet-chip">None</span>
      </div>
    </div>
  </div>

  <div class="player-health-widget">
    <div class="player-health-bar">
      <div class="liquid-wrapper">
        <span
          >{{ battleData.combatPlayer.stats.currentHealth }}/{{
            battleData.combatPlayer.stats.maxHealth
          }}</span
        >
        <div
          class="liquid danger"
          [style.height.%]="playerHealthPercentage"
        ></div>
      </div>
      <img src="/test/player-health-bar.png" class="orb-frame" />
    </div>
  </div>

  <div class="battle-logs panel-frame">
    <div class="panel-heading">Combat Log</div>
    <img
      class="sheet-divider compact"
      src="/battle-divider-ornate.svg"
      alt=""
      aria-hidden="true"
    />
    <div class="battle-logs-wrapper" #logContainer>
      <div class="log-entry log-empty" *ngIf="!logs.length">
        Awaiting clash...
      </div>
      <div
        class="log-entry"
        *ngFor="let log of logs"
        [class]="getLogClass(log)"
      >
        {{ log }}
      </div>
    </div>
  </div>

  <div class="ability-canvas">
    <img
      class="ability-icon"
      *ngFor="let ability of battleData.combatPlayer.abilities"
      [class.disabled]="ability.currentCooldown > 0"
      (click)="useAbility(ability)"
      src="/test/{{ ability.imageUrl }}"
      [attr.data-cooldown]="
        ability.currentCooldown > 0 ? ability.currentCooldown : null
      "
      alt="{{ ability.name }}"
    />
  </div>

  <app-reward-modal
    *ngIf="reward"
    [gold]="reward.gold || 100"
    [gems]="reward.experience || 200"
    [items]="reward.equipmentDrop || []"
  >
  </app-reward-modal>

  <app-defeat-modal *ngIf="defeat"></app-defeat-modal>
</div>
